apiVersion: experiments.chaosplatform.com/v1alpha1
kind: CisPersistent
metadata:
  name: cis-apiserver
spec:
  apiServerConfigurations: ["1.2.1", "1.2.7", "1.2.11", "1.2.21", "1.2.22"]
  podTemplate:
    nodeName: "minikube"
    hostPID: true
    restartPolicy: Never
    containers:
    - name: apiserver-misconfiguration
      image: 192.168.99.102:5000/api-server
      imagePullPolicy: Always
      lifecycle:
        preStop:
          exec:
            command: ["python3", "/src/recovery.py"]
      readinessProbe:
        exec:
          command:
          - cat
          - /tmp/ready
        initialDelaySeconds: 5
        periodSeconds: 5
      volumeMounts:
      - mountPath: "/etc/kubernetes/manifests/kube-apiserver.yaml"
        name: kube-apiserver
      resources:
        limits:
          cpu: "0.2"
          memory: "100Mi"
    volumes:
      - name: kube-apiserver
        hostPath:
            path: "/etc/kubernetes/manifests/kube-apiserver.yaml"
            type: File